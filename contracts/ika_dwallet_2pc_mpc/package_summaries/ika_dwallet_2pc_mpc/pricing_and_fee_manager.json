{
  "id": {
    "address": "ika_dwallet_2pc_mpc",
    "name": "pricing_and_fee_manager"
  },
  "doc": null,
  "immediate_dependencies": [
    {
      "address": "ika",
      "name": "ika"
    },
    {
      "address": "ika_common",
      "name": "bls_committee"
    },
    {
      "address": "ika_common",
      "name": "validator_cap"
    },
    {
      "address": "ika_dwallet_2pc_mpc",
      "name": "pricing"
    },
    {
      "address": "std",
      "name": "option"
    },
    {
      "address": "std",
      "name": "vector"
    },
    {
      "address": "sui",
      "name": "balance"
    },
    {
      "address": "sui",
      "name": "object"
    },
    {
      "address": "sui",
      "name": "sui"
    },
    {
      "address": "sui",
      "name": "table"
    },
    {
      "address": "sui",
      "name": "tx_context"
    }
  ],
  "attributes": [],
  "functions": {
    "create": {
      "source_index": 0,
      "index": 0,
      "doc": " Creates a new PricingAndFeeManager instance with initial configuration.\n\n ### Parameters\n - `pricing`: Default pricing configuration\n - `ctx`: Transaction context for object creation\n\n ### Returns\n A new PricingAndFeeManager instance ready for use",
      "attributes": [],
      "visibility": "Package",
      "entry": false,
      "type_parameters": [],
      "parameters": [
        {
          "name": "pricing",
          "type_": {
            "Datatype": {
              "module": {
                "address": "ika_dwallet_2pc_mpc",
                "name": "pricing"
              },
              "name": "PricingInfo",
              "type_arguments": []
            }
          }
        },
        {
          "name": "ctx",
          "type_": {
            "Reference": [
              true,
              {
                "Datatype": {
                  "module": {
                    "address": "sui",
                    "name": "tx_context"
                  },
                  "name": "TxContext",
                  "type_arguments": []
                }
              }
            ]
          }
        }
      ],
      "return_": [
        {
          "Datatype": {
            "module": {
              "address": "ika_dwallet_2pc_mpc",
              "name": "pricing_and_fee_manager"
            },
            "name": "PricingAndFeeManager",
            "type_arguments": []
          }
        }
      ]
    },
    "charge_gas_fee_reimbursement_sui_for_system_calls": {
      "source_index": 1,
      "index": 1,
      "doc": " Charges gas fee reimbursement for system-initiated operations.\n\n Allocates SUI from the coordinator's gas reimbursement pool to cover\n transaction costs for system operations like network DKG and reconfiguration.\n\n ### Parameters\n - `self`: Mutable reference to the coordinator\n\n ### Returns\n SUI balance to reimburse gas costs for system operations\n\n ### Logic\n - Returns zero if no reimbursement funds or value configured\n - Takes the minimum of available funds and configured system call value\n - Ensures system operations don't exhaust the entire reimbursement pool",
      "attributes": [],
      "visibility": "Package",
      "entry": false,
      "type_parameters": [],
      "parameters": [
        {
          "name": "self",
          "type_": {
            "Reference": [
              true,
              {
                "Datatype": {
                  "module": {
                    "address": "ika_dwallet_2pc_mpc",
                    "name": "pricing_and_fee_manager"
                  },
                  "name": "PricingAndFeeManager",
                  "type_arguments": []
                }
              }
            ]
          }
        }
      ],
      "return_": [
        {
          "Datatype": {
            "module": {
              "address": "sui",
              "name": "balance"
            },
            "name": "Balance",
            "type_arguments": [
              {
                "phantom": true,
                "argument": {
                  "Datatype": {
                    "module": {
                      "address": "sui",
                      "name": "sui"
                    },
                    "name": "SUI",
                    "type_arguments": []
                  }
                }
              }
            ]
          }
        }
      ]
    },
    "initiate_pricing_calculation": {
      "source_index": 2,
      "index": 2,
      "doc": null,
      "attributes": [],
      "visibility": "Package",
      "entry": false,
      "type_parameters": [],
      "parameters": [
        {
          "name": "self",
          "type_": {
            "Reference": [
              true,
              {
                "Datatype": {
                  "module": {
                    "address": "ika_dwallet_2pc_mpc",
                    "name": "pricing_and_fee_manager"
                  },
                  "name": "PricingAndFeeManager",
                  "type_arguments": []
                }
              }
            ]
          }
        },
        {
          "name": "next_epoch_active_committee",
          "type_": {
            "Datatype": {
              "module": {
                "address": "ika_common",
                "name": "bls_committee"
              },
              "name": "BlsCommittee",
              "type_arguments": []
            }
          }
        }
      ],
      "return_": []
    },
    "calculate_pricing_votes": {
      "source_index": 3,
      "index": 3,
      "doc": " Calculates the pricing votes for a given curve, signature algorithm and protocol.\n\n ### Parameters\n - **`self`**: Mutable reference to the PricingAndFeeManager\n - **`curve`**: The curve to calculate the pricing votes for.\n - **`signature_algorithm`**: The signature algorithm to calculate the pricing votes for.\n - **`protocol`**: The protocol to calculate the pricing votes for.",
      "attributes": [],
      "visibility": "Package",
      "entry": false,
      "type_parameters": [],
      "parameters": [
        {
          "name": "self",
          "type_": {
            "Reference": [
              true,
              {
                "Datatype": {
                  "module": {
                    "address": "ika_dwallet_2pc_mpc",
                    "name": "pricing_and_fee_manager"
                  },
                  "name": "PricingAndFeeManager",
                  "type_arguments": []
                }
              }
            ]
          }
        },
        {
          "name": "curve",
          "type_": "u32"
        },
        {
          "name": "signature_algorithm",
          "type_": {
            "Datatype": {
              "module": {
                "address": "std",
                "name": "option"
              },
              "name": "Option",
              "type_arguments": [
                {
                  "phantom": false,
                  "argument": "u32"
                }
              ]
            }
          }
        },
        {
          "name": "protocol",
          "type_": "u32"
        }
      ],
      "return_": []
    },
    "advance_epoch": {
      "source_index": 4,
      "index": 4,
      "doc": " Advances the epoch and returns the IKA balance charged for consensus validation.\n\n ### Logic\n - Aborts if pricing calculation votes are still in progress\n - Withdraws all IKA balance from the fee charged IKA balance\n\n ### Parameters\n - `self`: Mutable reference to the PricingAndFeeManager\n\n ### Returns\n IKA balance charged for consensus validation",
      "attributes": [],
      "visibility": "Package",
      "entry": false,
      "type_parameters": [],
      "parameters": [
        {
          "name": "self",
          "type_": {
            "Reference": [
              true,
              {
                "Datatype": {
                  "module": {
                    "address": "ika_dwallet_2pc_mpc",
                    "name": "pricing_and_fee_manager"
                  },
                  "name": "PricingAndFeeManager",
                  "type_arguments": []
                }
              }
            ]
          }
        }
      ],
      "return_": [
        {
          "Datatype": {
            "module": {
              "address": "sui",
              "name": "balance"
            },
            "name": "Balance",
            "type_arguments": [
              {
                "phantom": true,
                "argument": {
                  "Datatype": {
                    "module": {
                      "address": "ika",
                      "name": "ika"
                    },
                    "name": "IKA",
                    "type_arguments": []
                  }
                }
              }
            ]
          }
        }
      ]
    },
    "get_pricing_value_for_protocol": {
      "source_index": 5,
      "index": 5,
      "doc": " Returns the pricing value for a given curve, signature algorithm and protocol.\n\n ### Parameters\n - **`self`**: Mutable reference to the PricingAndFeeManager\n - **`curve`**: The curve to get the pricing value for.\n - **`signature_algorithm`**: The signature algorithm to get the pricing value for.\n - **`protocol`**: The protocol to get the pricing value for.\n\n ### Returns\n The pricing value for the given curve, signature algorithm and protocol",
      "attributes": [],
      "visibility": "Package",
      "entry": false,
      "type_parameters": [],
      "parameters": [
        {
          "name": "self",
          "type_": {
            "Reference": [
              false,
              {
                "Datatype": {
                  "module": {
                    "address": "ika_dwallet_2pc_mpc",
                    "name": "pricing_and_fee_manager"
                  },
                  "name": "PricingAndFeeManager",
                  "type_arguments": []
                }
              }
            ]
          }
        },
        {
          "name": "curve",
          "type_": "u32"
        },
        {
          "name": "signature_algorithm",
          "type_": {
            "Datatype": {
              "module": {
                "address": "std",
                "name": "option"
              },
              "name": "Option",
              "type_arguments": [
                {
                  "phantom": false,
                  "argument": "u32"
                }
              ]
            }
          }
        },
        {
          "name": "protocol",
          "type_": "u32"
        }
      ],
      "return_": [
        {
          "Datatype": {
            "module": {
              "address": "ika_dwallet_2pc_mpc",
              "name": "pricing"
            },
            "name": "PricingInfoValue",
            "type_arguments": []
          }
        }
      ]
    },
    "join_fee_charged_ika": {
      "source_index": 6,
      "index": 6,
      "doc": " Joins the fee charged IKA balance.\n\n ### Parameters\n - **`self`**: Mutable reference to the PricingAndFeeManager\n - **`fee_charged_ika`**: The fee charged IKA balance to join.",
      "attributes": [],
      "visibility": "Package",
      "entry": false,
      "type_parameters": [],
      "parameters": [
        {
          "name": "self",
          "type_": {
            "Reference": [
              true,
              {
                "Datatype": {
                  "module": {
                    "address": "ika_dwallet_2pc_mpc",
                    "name": "pricing_and_fee_manager"
                  },
                  "name": "PricingAndFeeManager",
                  "type_arguments": []
                }
              }
            ]
          }
        },
        {
          "name": "fee_charged_ika",
          "type_": {
            "Datatype": {
              "module": {
                "address": "sui",
                "name": "balance"
              },
              "name": "Balance",
              "type_arguments": [
                {
                  "phantom": true,
                  "argument": {
                    "Datatype": {
                      "module": {
                        "address": "ika",
                        "name": "ika"
                      },
                      "name": "IKA",
                      "type_arguments": []
                    }
                  }
                }
              ]
            }
          }
        }
      ],
      "return_": []
    },
    "join_gas_fee_reimbursement_sui_system_call_balance": {
      "source_index": 7,
      "index": 7,
      "doc": " Joins the gas fee reimbursement SUI system call balance.\n\n ### Parameters\n - **`self`**: Mutable reference to the PricingAndFeeManager\n - **`gas_fee_reimbursement_sui_for_system_calls`**: The gas fee reimbursement SUI system call balance to join.",
      "attributes": [],
      "visibility": "Package",
      "entry": false,
      "type_parameters": [],
      "parameters": [
        {
          "name": "self",
          "type_": {
            "Reference": [
              true,
              {
                "Datatype": {
                  "module": {
                    "address": "ika_dwallet_2pc_mpc",
                    "name": "pricing_and_fee_manager"
                  },
                  "name": "PricingAndFeeManager",
                  "type_arguments": []
                }
              }
            ]
          }
        },
        {
          "name": "gas_fee_reimbursement_sui_for_system_calls",
          "type_": {
            "Datatype": {
              "module": {
                "address": "sui",
                "name": "balance"
              },
              "name": "Balance",
              "type_arguments": [
                {
                  "phantom": true,
                  "argument": {
                    "Datatype": {
                      "module": {
                        "address": "sui",
                        "name": "sui"
                      },
                      "name": "SUI",
                      "type_arguments": []
                    }
                  }
                }
              ]
            }
          }
        }
      ],
      "return_": []
    },
    "set_gas_fee_reimbursement_sui_system_call_value": {
      "source_index": 8,
      "index": 8,
      "doc": " Sets the gas fee reimbursement SUI system call value.\n\n ### Parameters\n - **`gas_fee_reimbursement_sui_system_call_value`**: The gas fee reimbursement SUI system call value.",
      "attributes": [],
      "visibility": "Package",
      "entry": false,
      "type_parameters": [],
      "parameters": [
        {
          "name": "self",
          "type_": {
            "Reference": [
              true,
              {
                "Datatype": {
                  "module": {
                    "address": "ika_dwallet_2pc_mpc",
                    "name": "pricing_and_fee_manager"
                  },
                  "name": "PricingAndFeeManager",
                  "type_arguments": []
                }
              }
            ]
          }
        },
        {
          "name": "gas_fee_reimbursement_sui_system_call_value",
          "type_": "u64"
        }
      ],
      "return_": []
    },
    "set_default_pricing": {
      "source_index": 9,
      "index": 9,
      "doc": " Sets the default pricing.\n\n This function is used to set the default pricing.\n\n ### Parameters\n - **`default_pricing`**: The default pricing to use if pricing is missing for a protocol or curve.",
      "attributes": [],
      "visibility": "Package",
      "entry": false,
      "type_parameters": [],
      "parameters": [
        {
          "name": "self",
          "type_": {
            "Reference": [
              true,
              {
                "Datatype": {
                  "module": {
                    "address": "ika_dwallet_2pc_mpc",
                    "name": "pricing_and_fee_manager"
                  },
                  "name": "PricingAndFeeManager",
                  "type_arguments": []
                }
              }
            ]
          }
        },
        {
          "name": "default_pricing",
          "type_": {
            "Datatype": {
              "module": {
                "address": "ika_dwallet_2pc_mpc",
                "name": "pricing"
              },
              "name": "PricingInfo",
              "type_arguments": []
            }
          }
        }
      ],
      "return_": []
    },
    "set_pricing_vote": {
      "source_index": 10,
      "index": 10,
      "doc": " Sets the pricing vote for a validator.\n\n This function is used to set the pricing vote for a validator.\n Cannot be called during the votes calculation.\n\n ### Parameters\n - **`validator_id`**: The ID of the validator.\n - **`pricing_vote`**: The pricing vote for the validator.\n\n ### Errors\n - **`ECannotSetDuringVotesCalculation`**: If the pricing vote is set during the votes calculation.",
      "attributes": [],
      "visibility": "Package",
      "entry": false,
      "type_parameters": [],
      "parameters": [
        {
          "name": "self",
          "type_": {
            "Reference": [
              true,
              {
                "Datatype": {
                  "module": {
                    "address": "ika_dwallet_2pc_mpc",
                    "name": "pricing_and_fee_manager"
                  },
                  "name": "PricingAndFeeManager",
                  "type_arguments": []
                }
              }
            ]
          }
        },
        {
          "name": "pricing_vote",
          "type_": {
            "Datatype": {
              "module": {
                "address": "ika_dwallet_2pc_mpc",
                "name": "pricing"
              },
              "name": "PricingInfo",
              "type_arguments": []
            }
          }
        },
        {
          "name": "cap",
          "type_": {
            "Reference": [
              false,
              {
                "Datatype": {
                  "module": {
                    "address": "ika_common",
                    "name": "validator_cap"
                  },
                  "name": "VerifiedValidatorOperationCap",
                  "type_arguments": []
                }
              }
            ]
          }
        }
      ],
      "return_": []
    },
    "current_pricing": {
      "source_index": 11,
      "index": 11,
      "doc": " Returns the current pricing.\n\n ### Parameters\n - **`self`**: Mutable reference to the PricingAndFeeManager\n\n ### Returns\n The current pricing",
      "attributes": [],
      "visibility": "Package",
      "entry": false,
      "type_parameters": [],
      "parameters": [
        {
          "name": "self",
          "type_": {
            "Reference": [
              false,
              {
                "Datatype": {
                  "module": {
                    "address": "ika_dwallet_2pc_mpc",
                    "name": "pricing_and_fee_manager"
                  },
                  "name": "PricingAndFeeManager",
                  "type_arguments": []
                }
              }
            ]
          }
        }
      ],
      "return_": [
        {
          "Datatype": {
            "module": {
              "address": "ika_dwallet_2pc_mpc",
              "name": "pricing"
            },
            "name": "PricingInfo",
            "type_arguments": []
          }
        }
      ]
    }
  },
  "structs": {
    "PricingAndFeeManager": {
      "index": 0,
      "doc": " Pricing and fee management data for the dWallet coordinator.",
      "attributes": [],
      "abilities": [
        "Store"
      ],
      "type_parameters": [],
      "fields": {
        "positional_fields": false,
        "fields": {
          "current": {
            "index": 0,
            "doc": " Pricing for the current epoch",
            "type_": {
              "Datatype": {
                "module": {
                  "address": "ika_dwallet_2pc_mpc",
                  "name": "pricing"
                },
                "name": "PricingInfo",
                "type_arguments": []
              }
            }
          },
          "default": {
            "index": 1,
            "doc": " Default pricing configuration",
            "type_": {
              "Datatype": {
                "module": {
                  "address": "ika_dwallet_2pc_mpc",
                  "name": "pricing"
                },
                "name": "PricingInfo",
                "type_arguments": []
              }
            }
          },
          "validator_votes": {
            "index": 2,
            "doc": " Validator votes for pricing (validator ID -> pricing vote)",
            "type_": {
              "Datatype": {
                "module": {
                  "address": "sui",
                  "name": "table"
                },
                "name": "Table",
                "type_arguments": [
                  {
                    "phantom": true,
                    "argument": {
                      "Datatype": {
                        "module": {
                          "address": "sui",
                          "name": "object"
                        },
                        "name": "ID",
                        "type_arguments": []
                      }
                    }
                  },
                  {
                    "phantom": true,
                    "argument": {
                      "Datatype": {
                        "module": {
                          "address": "ika_dwallet_2pc_mpc",
                          "name": "pricing"
                        },
                        "name": "PricingInfo",
                        "type_arguments": []
                      }
                    }
                  }
                ]
              }
            }
          },
          "pricing_calculation_votes": {
            "index": 3,
            "doc": " Pricing calculation votes - if set, must complete before epoch advance",
            "type_": {
              "Datatype": {
                "module": {
                  "address": "std",
                  "name": "option"
                },
                "name": "Option",
                "type_arguments": [
                  {
                    "phantom": false,
                    "argument": {
                      "Datatype": {
                        "module": {
                          "address": "ika_dwallet_2pc_mpc",
                          "name": "pricing"
                        },
                        "name": "PricingInfoCalculationVotes",
                        "type_arguments": []
                      }
                    }
                  }
                ]
              }
            }
          },
          "gas_fee_reimbursement_sui_system_call_value": {
            "index": 4,
            "doc": " Gas fee reimbursement value for system calls",
            "type_": "u64"
          },
          "gas_fee_reimbursement_sui_system_call_balance": {
            "index": 5,
            "doc": " SUI balance for gas fee reimbursement to fund network tx responses",
            "type_": {
              "Datatype": {
                "module": {
                  "address": "sui",
                  "name": "balance"
                },
                "name": "Balance",
                "type_arguments": [
                  {
                    "phantom": true,
                    "argument": {
                      "Datatype": {
                        "module": {
                          "address": "sui",
                          "name": "sui"
                        },
                        "name": "SUI",
                        "type_arguments": []
                      }
                    }
                  }
                ]
              }
            }
          },
          "fee_charged_ika": {
            "index": 6,
            "doc": " IKA fees charged for consensus validation",
            "type_": {
              "Datatype": {
                "module": {
                  "address": "sui",
                  "name": "balance"
                },
                "name": "Balance",
                "type_arguments": [
                  {
                    "phantom": true,
                    "argument": {
                      "Datatype": {
                        "module": {
                          "address": "ika",
                          "name": "ika"
                        },
                        "name": "IKA",
                        "type_arguments": []
                      }
                    }
                  }
                ]
              }
            }
          }
        }
      }
    }
  },
  "enums": {}
}